# 异常的处理

![exception-handling](../../images/exception-handling.jpg)

我有一个做后端开发的程序员的同学，主要工作是给前端应用提供一些服务。曾经有一段时间，他几乎是天天收到客户的电话，叫他过来解决问题，当他跑过去解决问题时，不是客户网线没有插好，就是客户的路由器断电了。。。他解决的次数多了，就感觉有些奇怪，于是要求Review前端的代码，于是他看到了类似于如下的代码块：
```javascript
try {
    http.get('xxxxx');
    // 这里省略其他一些请求
} catch (err) {
    alert("服务异常，请联系：XXX，电话：138xxxxxxxxx");
}
```
看到这样代码的当天，他就连夜提桶跑路了。。。

错误处理及其重要，好的错误处理不仅能增加系统的健壮性，还能让人预约，但是不恰当的错误处理，不仅搞乱了代码逻辑，而且会让人连夜提桶跑路！

下面我们将指定一些异常处理的规范，并做举例说明！

## 使用异常而非返回码

请看下面的这段代码：
```java
public void sendShutDown() {
    DeviceHandle handle = getHandle(DEV1);
    if (handle != DiviceHandle.INVALID) {
        Record record = retrieveDeviceRecord(handle);
        if (record.getStatus() != DEVICE_SUPPORT) {
            pauseDevice(handle);
            clearDeviceWorkQueue(handle);
            closeDevice(handle);
        } else {
            Logger.error("Device Suspended. Unable to shut down!")
        }
    } else {
        Logger.error("Invalid handle for :" + DEV1.toString());
    }
}
```

上面代码的主要问题在于它们搞乱了调用者代码。调用者必须在调用之后即可检查错误。不幸的是，这个步骤经常被忘记，所以，遇到错误的时候，最好抛出一个异常。这样，调用的代码将很整洁，其逻辑不会被错误处理搞乱。

例如，上面代码可以改写如下：
```java
public void sendShutDown() {
    try {
        tryToShutDown();
    } catch(DeviceShutDownError error) {
        Logger.error(error);
    }
}

private void tryToShutDown() throws DeviceShutDownError() {
    DeviceHandle handle = getHandle(DEV1);
    Record record = retrieveDeviceRecord(handle);
    pauseDevice(handle);
    clearDeviceWorkQueue(handle);
    closeDevice(handle);
}
```

